<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %><%PrintWriter writer;try {writer = response.getWriter();writer.write(65279);}catch (Exception e) {}%><%@ taglib uri="http://www.springframework.org/tags/form" prefix="form" %><%@ taglib uri="http://www.springframework.org/tags" prefix="spring" %><%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %><%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %><%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %><%@ taglib uri="/WEB-INF/str.tld" prefix="str" %><% String lang = response.getLocale().getLanguage(); %><str:map appCode="AMPARTNERPORTAL" lang="<%=lang%>" cache="true" strId='AMPARTNERPORTAL'/><%@page import="com.asiamiles.partnerportal.domain.UserSession"%><%@ page import="java.io.PrintWriter" %><% response.setHeader("Pragma", "public"); response.setHeader("Cache-Control", "max-age=0");%><% response.setContentType("application/CSV;charset=Unicode"); response.setHeader("content-disposition", "attachment; filename=\"" + "report.csv\""); %><str:label strId="AMPARTNERPORTAL" key="label_claim_no"/>,<str:label strId="AMPARTNERPORTAL" key="label_redemption_item_package_code"/>,<str:label strId="AMPARTNERPORTAL" key="label_status"/>,<str:label strId="AMPARTNERPORTAL" key="label_date"/> (GMT <c:out value="${timeZone}"/>),<str:label strId="AMPARTNERPORTAL" key="label_agent_id"/>,<str:label strId="AMPARTNERPORTAL" key="label_recipient"/>,<str:label strId="AMPARTNERPORTAL" key="label_receipt_ref"/>,<%UserSession userSession = (UserSession) request.getSession().getAttribute("userSession");%><c:set var="key1">label_partner_remark_1_<%=userSession.getAgent().getPartnerCode()%></c:set><c:set var="key2">label_partner_remark_2_<%=userSession.getAgent().getPartnerCode()%></c:set><c:set var="rem_1"><str:label strId="AMPARTNERPORTAL" key="${key1}"/></c:set><c:set var="rem_2"><str:label strId="AMPARTNERPORTAL" key="${key2}"/></c:set><c:if test="${key1 ne rem_1}">${rem_1}</c:if><c:if test="${key1 eq rem_1}"><str:label strId="AMPARTNERPORTAL" key="label_partner_remark_1"/></c:if>,<c:if test="${key2 ne rem_2}">${rem_2}</c:if><c:if test="${key2 eq rem_2}"><str:label strId="AMPARTNERPORTAL" key="label_partner_remark_2"/></c:if><c:set var="currentLocale" value="${pageContext.response.locale}"/><fmt:setLocale value="en" scope="session"/><c:forEach items="${reportForm.claims}" var="claim" varStatus="claimCount">
<c:out value="${claim.claimNo}"/>,<c:out value="${claim.packageDescription}"/> (<c:out value="${claim.packageCode}"/>),<c:choose> <c:when test="${empty claim.completionTime}"> <str:label strId="AMPARTNERPORTAL" key="label_in_progress"/> </c:when> <c:otherwise> <c:choose> <c:when test="${empty claim.billedDate}"> <str:label strId="AMPARTNERPORTAL" key="label_completed"/> </c:when> <c:otherwise> <str:label strId="AMPARTNERPORTAL" key="label_billed"/> </c:otherwise> </c:choose> </c:otherwise> </c:choose> , <c:choose> <c:when test="${!empty claim.billedDate}"> <fmt:formatDate value="${claim.billedDate}" pattern="dd MMM yyyy"/> </c:when> <c:otherwise> <c:choose> <c:when test="${!empty claim.completionTime}"> <fmt:formatDate value="${claim.completionTime}" pattern="dd MMM yyyy HH:mm"/> </c:when> <c:otherwise> <fmt:formatDate value="${claim.collectionTime}" pattern="dd MMM yyyy HH:mm"/> </c:otherwise> </c:choose> </c:otherwise> </c:choose> , <c:choose><c:when test="${!empty claim.completionHandledBy}"><c:out value="${claim.completionHandledBy}"/></c:when><c:otherwise><c:out value="${claim.collectionHandledBy}"/></c:otherwise></c:choose>,<c:out value="${claim.holderName}"/> <c:out value="${claim.holderFirstName}"/>,<c:out value="${claim.receiptNo}"/>,"<c:out value="${claim.remarks}"/>","<c:out value="${claim.remarks2}"/>"</c:forEach><fmt:setLocale value="${currentLocale}" scope="session"/>